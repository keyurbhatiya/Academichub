{% extends 'core/base.html' %}
{% block title %}AcademicHub - Discover Academic Papers, Projects & Blogs{% endblock %}
{% block content %}
{% load static %}

<meta name="description" content="Explore AcademicHub for academic papers, student projects, and insightful blogs. Connect with a global community of learners and researchers.">
<meta name="keywords" content="academic resources, research papers, student projects, educational blogs, university resources, knowledge sharing">
<meta name="author" content="AcademicHub Team">
<meta name="robots" content="index, follow">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="canonical" href="https://academichub-frio.onrender.com/">

<meta property="og:title" content="AcademicHub - Unlock Knowledge with Papers, Projects & Blogs">
<meta property="og:description" content="Discover a wealth of academic resources including papers, student projects, and blogs at AcademicHub. Join our community today!">
<meta property="og:type" content="website">
<meta property="og:url" content="https://academichub-frio.onrender.com/">

<meta property="og:site_name" content="AcademicHub">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="AcademicHub - Unlock Knowledge with Papers, Projects & Blogs">
<meta name="twitter:description" content="Discover academic papers, projects, and blogs at AcademicHub. Join our community of learners and researchers!">


<main class="bg-gray-100 min-h-screen font-sans">
    {% if user.is_authenticated %}
    <div class="fixed top-4 right-4 z-50 transition-opacity duration-500 ease-in-out" id="welcome-message-container" role="alert" aria-live="polite">
        <div class="flex items-center max-w-sm w-full p-4 bg-white rounded-xl shadow-lg border-l-4 border-blue-600">
            <i class="fas fa-check-circle text-blue-600 text-xl mr-3"></i>
            <div class="text-sm font-medium text-gray-900">
                Welcome back, {{ user.first_name|default:user.username }}!
            </div>
        </div>
    </div>
    {% endif %}

    <header class="bg-gradient-to-r from-blue-700 to-indigo-800 text-white py-16 md:py-24" role="banner">
        <div class="container mx-auto px-6 text-center">
            <h1 class="text-4xl md:text-5xl font-extrabold mb-4 tracking-tight">Discover Academic Excellence</h1>
            <p class="text-lg md:text-xl text-gray-200 max-w-3xl mx-auto mb-8 leading-relaxed">
                AcademicHub is your gateway to academic papers, innovative student projects, and thought-provoking blogs. Join our vibrant community today.
            </p>
            <div class="flex flex-wrap justify-center items-center gap-6 md:gap-10 text-sm text-gray-200">
                <div class="flex items-center">
                    <i class="fas fa-file-alt mr-2 text-blue-300"></i>
                    <span class="font-semibold">{{ total_papers }} Papers</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-project-diagram mr-2 text-green-300"></i>
                    <span class="font-semibold">{{ total_projects }} Projects</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-users mr-2 text-purple-300"></i>
                    <span class="font-semibold">{{ total_users }} Users</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-12 md:py-16">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">
            <div class="lg:col-span-2 space-y-12" role="main">
                <section aria-labelledby="latest-papers-heading">
                    <h2 id="latest-papers-heading" class="text-3xl font-bold text-gray-900 mb-6 border-l-4 border-blue-600 pl-4">Latest Research Papers</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% for paper in papers %}
                        <article class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 transition-transform transform hover:scale-105 hover:shadow-xl">
                            <h3 class="font-semibold text-xl text-gray-900 mb-2">{{ paper.title }}</h3>
                            <p class="text-sm text-gray-600 mb-3">{{ paper.university }} &bull; Semester {{ paper.semester }}</p>
                            <button onclick="openModal('{{ paper.drive_url|escapejs }}', '{{ paper.title|escapejs }}')" class="bg-blue-600 text-white font-semibold text-sm px-4 py-2 rounded-lg flex items-center hover:bg-blue-700 transition-colors" aria-label="View paper: {{ paper.title }}">
                                <i class="ri-eye-line mr-2"></i> View Paper
                            </button>
                        </article>
                        {% empty %}
                        <p class="md:col-span-2 text-gray-600">No papers available at the moment.</p>
                        {% endfor %}
                    </div>
                </section>
                
                <div class="bg-gray-200 p-4 rounded-xl text-center text-sm text-gray-600">
                    <p>Advertisement</p>
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5598747900532447" crossorigin="anonymous"></script>
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-layout="in-article"
                         data-ad-format="fluid"
                         data-ad-client="ca-pub-5598747900532447"
                         data-ad-slot="3367865871"
                         data-lazy-load="true"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>

                <hr class="my-12 border-gray-300">

                <section aria-labelledby="featured-projects-heading">
                    <h2 id="featured-projects-heading" class="text-3xl font-bold text-gray-900 mb-6 border-l-4 border-green-600 pl-4">Featured Student Projects</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        {% for project in projects %}
                        <article class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 transition-transform transform hover:scale-105 hover:shadow-xl">
                            <h3 class="font-semibold text-xl text-green-600 hover:text-green-800 mb-2">
                                <a href="{% url 'project_detail' project.slug %}" class="hover:underline">
                                    {{ project.title }}
                                </a>
                            </h3>
                            <p class="text-sm text-gray-600 line-clamp-2 mb-3">{{ project.description }}</p>
                            <a href="{% url 'project_detail' project.slug %}" class="font-semibold text-sm text-green-600 hover:text-green-800 transition-colors" aria-label="View project: {{ project.title }}">View Project &rarr;</a>
                        </article>
                        {% empty %}
                        <p class="md:col-span-2 text-gray-600">No projects available at the moment.</p>
                        {% endfor %}
                    </div>
                </section>

                <hr class="my-12 border-gray-300">
                
                <div class="bg-gray-200 p-4 rounded-xl text-center text-sm text-gray-600">
                    <p>Advertisement</p>
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5598747900532447" crossorigin="anonymous"></script>
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-layout="in-article"
                         data-ad-format="fluid"
                         data-ad-client="ca-pub-5598747900532447"
                         data-ad-slot="9665680917"
                         data-lazy-load="true"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>

                <hr class="my-12 border-gray-300">

                <section aria-labelledby="recent-blogs-heading">
                    <h2 id="recent-blogs-heading" class="text-3xl font-bold text-gray-900 mb-6 border-l-4 border-purple-600 pl-4">Recent Blogs</h2>
                    <div class="space-y-6">
                        {% for blog in blogs %}
                        <article class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 transition-transform transform hover:scale-105 hover:shadow-xl">
                            <h3 class="font-semibold text-xl text-gray-900 mb-2">{{ blog.title }}</h3>
                            <p class="text-sm text-gray-600 mb-3">By <span class="font-medium text-gray-800">{{ blog.author }}</span> in <span class="font-medium text-gray-800">{{ blog.category|default:"General" }}</span></p>
                            <a href="{% url 'blog_detail' blog.slug %}" class="font-semibold text-sm text-purple-600 hover:text-purple-800 transition-colors" aria-label="Read blog post: {{ blog.title }}">Read More &rarr;</a>
                        </article>
                        {% empty %}
                        <p class="text-gray-600">No blogs available at the moment.</p>
                        {% endfor %}
                    </div>
                </section>
            </div>

            <aside class="space-y-8" role="complementary">
                <div class="bg-gray-200 p-4 rounded-xl text-center text-sm text-gray-600">
                    <p>Advertisement</p>
                    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5598747900532447" crossorigin="anonymous"></script>
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-layout="in-article"
                         data-ad-format="fluid"
                         data-ad-client="ca-pub-5598747900532447"
                         data-ad-slot="2737326390"
                         data-lazy-load="true"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>

                <section class="bg-white p-6 rounded-xl shadow-lg border border-gray-200" aria-labelledby="about-heading">
                    <h3 id="about-heading" class="font-semibold text-xl text-gray-900 mb-4">About AcademicHub</h3>
                    <p class="text-sm text-gray-600 mb-4">AcademicHub is a community-driven platform dedicated to fostering knowledge sharing. Connect with students and researchers worldwide.</p>
                    <a href="#" class="text-sm font-semibold text-blue-600 hover:text-blue-800 transition-colors">Learn More...</a>
                </section>
                
                <section class="bg-white p-6 rounded-xl shadow-lg border border-gray-200 text-center" aria-labelledby="contribute-heading">
                    <h3 id="contribute-heading" class="font-semibold text-xl text-gray-900 mb-3">Contribute Your Work</h3>
                    <p class="text-sm text-gray-600 mb-4">Share your academic papers, projects, or blogs to inspire and educate others in our community.</p>
                    <a href="#" class="w-full block bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition-all focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Upload Now
                    </a>
                </section>
            </aside>
        </div>
    </div>

    <div id="pdfModal" role="dialog" aria-modal="true" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden" aria-labelledby="modalTitle">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-5xl h-full max-h-[95vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 id="modalTitle" class="text-xl font-semibold text-gray-800 truncate pr-4">PDF Viewer</h2>
                <div class="flex items-center space-x-4">
                    <button id="copyLinkBtn" class="text-blue-600 hover:text-blue-800 transition-colors" title="Copy share link" aria-label="Copy PDF link to clipboard">
                        <i class="ri-clipboard-line text-lg"></i>
                    </button>
                    <a id="downloadBtn" href="#" target="_blank" class="text-blue-600 hover:text-blue-800 transition-colors" title="Open in new tab" aria-label="Open PDF in a new tab">
                        <i class="ri-external-link-line text-lg"></i>
                    </a>
                    <button id="closeModalBtn" onclick="closeModal()" class="text-gray-500 hover:text-gray-900 text-3xl leading-none" aria-label="Close PDF viewer modal">&times;</button>
                </div>
            </div>
            <div class="flex-grow p-1 relative">
                <div id="pdf-loader" class="absolute inset-0 flex items-center justify-center bg-gray-50">
                    <div class="w-10 h-10 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"></div>
                </div>
                <div id="pdf-error" class="hidden absolute inset-0 flex flex-col items-center justify-center text-red-600 p-4 text-center">
                    <i class="ri-error-warning-fill text-3xl mb-2"></i>
                    <p class="font-semibold">Failed to load PDF.</p>
                    <p class="text-sm text-gray-600">The Google Drive link may be invalid or not shared publicly.</p>
                </div>
                <iframe id="pdfViewer" src="about:blank" class="w-full h-full" frameborder="0"></iframe>
            </div>
        </div>
    </div>

    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "AcademicHub",
        "url": "https://academichub-frio.onrender.com/",
        "description": "AcademicHub is a platform for academic papers, student projects, and educational blogs.",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://academichub-frio.onrender.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
</main>

<style>
    .line-clamp-2 {
        overflow: hidden;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const welcomeMessage = document.getElementById('welcome-message-container');
        if (welcomeMessage) {
            setTimeout(() => {
                welcomeMessage.classList.add('opacity-0');
                setTimeout(() => welcomeMessage.remove(), 500);
            }, 3000);
        }

        const ads = document.querySelectorAll('.adsbygoogle');
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    (adsbygoogle = window.adsbygoogle || []).push({});
                    observer.unobserve(entry.target);
                }
            });
        }, { rootMargin: '0px 0px 100px 0px' });

        ads.forEach(ad => observer.observe(ad));
    });

    const pdfModal = document.getElementById('pdfModal');
    const pdfViewer = document.getElementById('pdfViewer');
    const modalTitle = document.getElementById('modalTitle');
    const pdfLoader = document.getElementById('pdf-loader');
    const pdfError = document.getElementById('pdf-error');
    const downloadBtn = document.getElementById('downloadBtn');
    const copyLinkBtn = document.getElementById('copyLinkBtn');

    function openModal(driveUrl, title) {
        modalTitle.textContent = title;
        pdfViewer.src = 'about:blank';
        pdfError.classList.add('hidden');
        pdfLoader.classList.remove('hidden');
        pdfModal.classList.remove('hidden');

        const match = driveUrl.match(/\/d\/([a-zA-Z0-9-_]+)/);
        if (match && match[1]) {
            const fileId = match[1];
            const viewerUrl = `https://drive.google.com/file/d/${fileId}/preview`;
            pdfViewer.src = viewerUrl;

            downloadBtn.href = driveUrl;
            copyLinkBtn.onclick = () => {
                navigator.clipboard.writeText(driveUrl).then(() => {
                    alert('Link copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy link: ', err);
                });
            };
        } else {
            pdfLoader.classList.add('hidden');
            pdfError.classList.remove('hidden');
            downloadBtn.href = '#';
            copyLinkBtn.onclick = null;
        }
    }

    function closeModal() {
        pdfModal.classList.add('hidden');
        pdfViewer.src = 'about:blank';
        pdfLoader.classList.add('hidden');
        pdfError.classList.add('hidden');
    }

    pdfViewer.addEventListener('load', () => {
        pdfLoader.classList.add('hidden');
        try {
            if (pdfViewer.contentDocument && pdfViewer.contentDocument.body.innerHTML.trim() === '') {
                pdfError.classList.remove('hidden');
            }
        } catch (e) {
            // Cross-origin restriction, assume loaded
        }
    });

    pdfModal.addEventListener('click', (event) => {
        if (event.target === pdfModal) {
            closeModal();
        }
    });

    document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !pdfModal.classList.contains('hidden')) {
            closeModal();
        }
    });
</script>
{% endblock %}